<!DOCTYPE html>
<html lang="en" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>
<body>
<h1>Привет Лидулечке сладкой писечке!! </h1>
<p style="font-size: 40px; font-style: italic; color: #636699;">Дополнительный текст между h1 и h2.</p>
<h2 style="font-size:60px; font-style: italic; color: #777699;">У тебя все получится  </h2>
<h1 th:text="'Я знаю как тебя зовут ' + ${#authentication.getPrincipal().getName()}"
    style="font-size: 60px; font-style: normal;">Normal Text
</h1>
<table class="table table-striped-columns">
    <thead>
    <tr>
        <th scope="col">id</th>
        <th scope="col">name</th>
        <th scope="col">email</th>
        <th scope="col">password</th>
        <th sec:authorize="hasAuthority('ADMIN_ROLE')" scope="col">action</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="user: ${users}">
        <th th:text="${user.getId()}" scope="row"></th>
        <th th:text="${user.getName()}" scope="row"></th>
        <th th:text="${user.getEmail()}" scope="row"></th>
        <th th:text="${user.getPassword()}" scope="row"></th>
        <td sec:authorize="hasAuthority('ADMIN_ROLE')">
            <button class="delete-btn" th:attr="data-userid=${user.getId()}">Удалить</button>
        </td>

        <td></td>
        <td></td>
    </tr>
    </tbody>
</table>
<form th:action="@{/logout}" method="post">
    <input type="submit" value="logout">
</form>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        var deleteButtons = document.querySelectorAll('.delete-btn');

        deleteButtons.forEach(function (button) {
            button.addEventListener('click', function () {
                var userId = button.getAttribute('data-userid');
                var csrfToken = document.querySelector("meta[name='_csrf']").getAttribute("content");

                confirmDelete(userId, csrfToken);
            });
        });

        function confirmDelete(userId, csrfToken) {
            if (confirm('Вы уверены, что хотите удалить этого пользователя?')) {
                fetch('/deleteUser/' + userId, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRF-TOKEN': csrfToken
                    },
                })
                    .then(response => {
                        if (response.ok) {
                            location.reload(); // Перезагрузите страницу после успешного удаления
                        } else {
                            console.error('Не удалось удалить пользователя');
                        }
                    })
                    .catch(error => {
                        console.error('Ошибка во время выполнения операции fetch:', error);
                    });
            }
        }
    });
</script>
</body>
</html>
